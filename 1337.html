<html lang="en-US">
<head>
<title>HTML Smiley Emoji</title>
<meta charset="utf-8">
<script type="text/javascript" src="data.js"></script>
<script type="text/javascript" src="flags.js"></script>
<script type="text/javascript" src="https://momentjs.com/downloads/moment.min.js"></script>
<script type="text/javascript" src="https://momentjs.com/downloads/moment-timezone-with-data-10-year-range.min.js"></script>
<script type="text/javascript">

let date = new Date;
let countries = new Array();

moment.tz.names().forEach((timeZone) => {	
    let strTime = date.toLocaleString("en-US", {timeZone: `${timeZone}`});
    
	let localDate = new Date(strTime);
	var localHours = localDate.getHours();
	var localMinutes = localDate.getMinutes();
	
	var partyTime = localHours == 13 && localMinutes == 37;
	var almostTime = localHours == 13 && localMinutes <= 37;
	var nextTime = localHours == 12 && localMinutes > 37;

	if(almostTime || nextTime) {
		let country = findCountryByTimeZone(timeZone);
		if(country) {			
			countries.push(country);
		}
	}
});

var countryCounts = countries.reduce((map, country) => {	
	var idx = map.findIndex(e => e.country == country);
	if(idx > -1) {
		map[idx].count++;
	} else {
		map.push({country: country, count: 1});
	}
	return map;
}, []);

var highestRankdCountry = countryCounts.reduce((r, v) => {
	if(!r.country || r.count <= v.count) {
		r = v;
	}
	return r;
}, {});

if(highestRankdCountry.country) {
	printUnicodeFlagByCountryCode(highestRankdCountry.country)
}

function findCountryByTimeZone(timeZoneName) {
	var country =  timeZoneCountries.timezones[timeZoneName];

	if(country && country.c) {
		return country.c;
	}
}

function printUnicodeFlagByCountryCode(countryCode) {
	if(!countryCode) {
		return;
	}

	let flagCode = flags.filter(f => f.code == countryCode)[0];
	document.write("<img src='flags/" + flagCode.unicode.replace(/U\+/g, "").replace(" ", "-") + ".svg' />" )
}
</script>
</head>